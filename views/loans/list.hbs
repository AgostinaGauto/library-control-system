<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Gesti√≥n de Pr√©stamos </h2>
            <a href="/loans/new" class="btn btn-success">
                <i class="fas fa-hand-holding"></i> Nuevo Pr√©stamo
            </a>
        </div>
        
        {{#if prestamos}}
        <div class="card shadow-lg">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Socio</th>
                                <th>Libros Prestados</th>
                                <th class="text-center">F. Pr√©stamo</th>
                                <th class="text-center">F. Devoluci√≥n</th>
                                <th class="text-center">Estado</th>
                                <th class="text-center" style="width: 250px;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each prestamos}}
                            <tr>
                                <td>{{id_prestamo}}</td>
                                <td>{{nomyape_socio}}</td>
                                <td>
                                    <!-- Muestra la lista de libros unidos por el controlador -->
                                    <small>{{librosPrestados}}</small>
                                </td>
                                <td class="text-center">{{fecha_prestamo_fmt}}</td>
                                <td class="text-center">
                                    {{#if fecha_devolucion_fmt}}
                                        <span class="badge bg-secondary text-white">{{fecha_devolucion_fmt}}</span>
                                    {{else}}
                                        <span class="text-muted fst-italic">Pendiente</span>
                                    {{/if}}
                                </td>
                                <td class="text-center">
                                    {{#if isVigente}}
                                        <span class="badge bg-warning text-dark">Vigente</span>
                                    {{else}}
                                        <span class="badge bg-success">Devuelto</span>
                                    {{/if}}
                                </td>
                                <td class="text-center">
                                    <!-- üîπ Bot√≥n Ver Detalle -->
                                    <a href="/loans/{{id_prestamo}}/detalle" class="btn btn-sm btn-info text-white me-2" title="Ver detalle del pr√©stamo">
                                        <i class="fas fa-eye"></i> Ver Detalle
                                    </a>

                                    {{#if isVigente}}
                                        <!-- Bot√≥n Marcar como Devuelto (PUT) -->
                                        <form action="/loans/return/{{id_prestamo}}?_method=PUT" method="POST" class="d-inline" onsubmit="return confirm('¬øConfirma la devoluci√≥n de este pr√©stamo? Esto actualizar√° los libros a \"en biblioteca\".');">
                                            <button type="submit" class="btn btn-sm btn-success" title="Marcar como Devuelto">
                                                <i class="fas fa-check"></i> Devolver
                                            </button>
                                        </form>
                                    {{else}}
                                        <!-- Bot√≥n Eliminar (DELETE) -->
                                        <form action="/loans/{{id_prestamo}}?_method=DELETE" method="POST" class="d-inline" onsubmit="return confirm('¬øEst√° seguro de que desea eliminar este registro de pr√©stamo devuelto?');">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar Pr√©stamo">
                                                <i class="fas fa-trash"></i> Eliminar
                                            </button>
                                        </form>
                                    {{/if}}
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {{else}}
        <div class="alert alert-info shadow mt-4" role="alert">
            <h4 class="alert-heading"><i class="fas fa-info-circle"></i> ¬°A√∫n no hay pr√©stamos!</h4>
            Parece que no se ha registrado ning√∫n pr√©stamo en el sistema. Empiece por crear uno <a href="/loans/new" class="alert-link">aqu√≠</a>.
        </div>
        {{/if}}
    </div>
</div>